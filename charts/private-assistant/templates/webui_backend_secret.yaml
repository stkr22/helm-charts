{{- if and .Values.webUi.enabled (not .Values.webUi.existingSecret) }}
apiVersion: v1
kind: Secret
metadata:
  name: {{ include "private-assistant.fullname" . }}-webui-backend
  labels:
    {{- include "private-assistant.labels" . | nindent 4 }}
  annotations:
    helm.sh/resource-policy: keep
    description: "Auto-generated secrets for Web UI. Values persist across upgrades."
type: Opaque
data:
  # PostgreSQL password from global config
  {{- if .Values.postgres.existingSecret.enabled }}
  postgres-password: {{ "placeholder" | b64enc | quote }}
  {{- else }}
  postgres-password: {{ .Values.postgres.password | b64enc | quote }}
  {{- end }}

  # MinIO credentials (defaults for external MinIO)
  minio-access-key: {{ "minioadmin" | b64enc | quote }}
  minio-secret-key: {{ "minioadmin" | b64enc | quote }}

  # Auto-generated secrets (persist across upgrades via lookup)
  secret-key: {{ include "private-assistant.webui.secretKey" . | b64enc | quote }}
  first-superuser-password: {{ include "private-assistant.webui.firstSuperuserPassword" . | b64enc | quote }}

  # MQTT password
  mqtt-password: {{ .Values.mosquitto.password | b64enc | quote }}
{{- end }}
